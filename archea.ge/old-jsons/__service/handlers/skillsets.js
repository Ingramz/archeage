// [{"id":1,"name":"Battlerage","skills":[18132,11918,10377,13282,10644,10455,12026,13315,12034,18308,18757,23587],"ancestrals":[36401,36404,36446,36447,36448,36449,39661,39662,41217,41218,43188,43189],"passives":[2610,7542,2621,811,831,7544]},{"id":2,"name":"Witchcraft","skills":[14376,10159,10154,10409,23934,10712,10134,10665,11443,11353,12001,23588],"ancestrals":[36450,36451,44258,36452,36453,36454,36455,39291,39292,40774,40777,44252],"passives":[482,805,7545,806,1124,7546]},{"id":3,"name":"Defense","skills":[10399,11365,10501,12048,12039,10375,10436,10645,10655,12046,14529,10372],"ancestrals":[36456,36457,44265,36458,36459,36460,36461,39289,39290,40779,40780,42857,42858,44269],"passives":[812,7549,7550,490,7551,2753]},{"id":4,"name":"Auramancy","skills":[16486,18222,11869,10710,10152,11424,11989,11429,11991,11380,10714,23589],"ancestrals":[36462,36463,36464,36465,36466,36467,39293,39294,40781,40782,44348],"passives":[927,7553,621,2784,7554,498]},{"id":5,"name":"Occultism","skills":[10201,11441,10488,34171,12075,14760,11395,10135,11442,11504,10434,23591],"ancestrals":[36620,36623,44321,44339,36586,36587,44346,44347,36626,36627,39295,39296,40785,40786],"passives":[539,2970,7561,2926,7563,971]},{"id":6,"name":"Archery","skills":[14835,16210,10694,12759,15096,12133,15073,11933,10708,11368,13281,23592],"ancestrals":[36468,36469,36470,36471,36472,36473,39663,39666,41219,41221,42849,42851],"passives":[486,888,480,7565,889,7564]},{"id":7,"name":"Sorcery","skills":[10752,10667,10153,10670,12796,10151,14774,11967,11939,11314,10664,23593],"ancestrals":[36474,36475,36476,36477,36478,36479,39669,39674,41222,41223,43068,43185],"passives":[536,2910,962,7566,963,7567]},{"id":8,"name":"Shadowplay","skills":[18125,10481,13344,12049,10648,12139,12029,10082,10189,10496,10104,23594],"ancestrals":[36588,36589,36590,36591,36593,36594,39297,39298,40787,40788,44288,44289],"passives":[7572,7570,483,1548,863,488]},{"id":9,"name":"Songcraft","skills":[11973,11934,10723,11943,37839,10724,17413,11377,11396,37886,10727,23596],"ancestrals":[36597,36598,36595,36596,36628,36629,39299,39300,40789,40790,44349,44379,43196,43197,44382,44383],"passives":[23068,3840,494,7574,1173,1156]},{"id":10,"name":"Vitalism","skills":[33345,11379,10534,10547,13286,10720,10546,14929,17412,16004,16783,11948],"ancestrals":[36630,36631,36636,36637,36632,36635,39675,39676,41224,41225,43207,43208,43209],"passives":[753,558,7586,7585,3172,2927]},{"id":11,"name":"Malediction","skills":[39007,39012,39017,39016,39018,39015,39021,39020,39019,39022,39023,39024],"ancestrals":[39163,39166,39677,39678,40791,40792,41226,41227],"passives":[23078,23071,23079,23074,23081,23073]},{"id":12,"name":"Swiftblade","skills":[40331,40337,40339,40333,40336,40335,40342,40334,40341,40332,40340,40338],"ancestrals":[43211,43213,43212],"passives":[24895,24913,24909,24914,24911,24910]}]

const _skillsets = [
  {
      "id": 1,
      "name": "Battlerage",
      "skills": [
          18132,
          11918,
          10377,
          13282,
          10644,
          10455,
          12026,
          13315,
          12034,
          18308,
          18757,
          23587
      ],
      "ancestrals": [
          36401,
          36404,
          36446,
          36447,
          36448,
          36449,
          39661,
          39662,
          41217,
          41218,
          43188,
          43189
      ],
      "passives": [
          2610,
          7542,
          2621,
          811,
          831,
          7544
      ]
  },
  {
      "id": 2,
      "name": "Witchcraft",
      "skills": [
          14376,
          10159,
          10154,
          10409,
          23934,
          10712,
          10134,
          10665,
          11443,
          11353,
          12001,
          23588
      ],
      "ancestrals": [
          36450,
          36451,
          44258,
          36452,
          36453,
          46195,
          36454,
          36455,
          39291,
          39292,
          40774,
          40777,
          44252,
          46191
      ],
      "passives": [
          482,
          805,
          7545,
          806,
          1124,
          7546
      ]
  },
  {
      "id": 3,
      "name": "Defense",
      "skills": [
          10399,
          11365,
          10501,
          12048,
          12039,
          10375,
          10436,
          10645,
          10655,
          12046,
          14529,
          10372
      ],
      "ancestrals": [
          36456,
          36457,
          44265,
          36458,
          36459,
          46075,
          36460,
          36461,
          39289,
          39290,
          40779,
          40780,
          42857,
          42858,
          46136,
          44269
      ],
      "passives": [
          812,
          7549,
          7550,
          490,
          7551,
          2753
      ]
  },
  {
      "id": 4,
      "name": "Auramancy",
      "skills": [
          16486,
          18222,
          11869,
          10710,
          10152,
          11424,
          11989,
          11429,
          11991,
          11380,
          10714,
          23589
      ],
      "ancestrals": [
          36462,
          36463,
          36464,
          36465,
          46137,
          36466,
          36467,
          46138,
          39293,
          39294,
          40781,
          40782,
          44348
      ],
      "passives": [
          927,
          7553,
          621,
          2784,
          7554,
          498
      ]
  },
  {
      "id": 5,
      "name": "Occultism",
      "skills": [
          10201,
          11441,
          10488,
          34171,
          12075,
          14760,
          11395,
          10135,
          11442,
          11504,
          10434,
          23591
      ],
      "ancestrals": [
          36620,
          36623,
          44321,
          44339,
          36586,
          36587,
          44346,
          44347,
          36626,
          36627,
          39295,
          39296,
          40785,
          40786,
          46140,
          46184
      ],
      "passives": [
          539,
          2970,
          7561,
          2926,
          7563,
          971
      ]
  },
  {
      "id": 6,
      "name": "Archery",
      "skills": [
          14835,
          16210,
          10694,
          12759,
          15096,
          12133,
          15073,
          11933,
          10708,
          11368,
          13281,
          23592
      ],
      "ancestrals": [
          36468,
          36469,
          36470,
          36471,
          36472,
          36473,
          39663,
          39666,
          41219,
          41221,
          42849,
          42851
      ],
      "passives": [
          486,
          888,
          480,
          7565,
          889,
          7564
      ]
  },
  {
      "id": 7,
      "name": "Sorcery",
      "skills": [
          10752,
          10667,
          10153,
          10670,
          12796,
          10151,
          14774,
          11967,
          11939,
          11314,
          10664,
          23593
      ],
      "ancestrals": [
          36474,
          36475,
          36476,
          36477,
          36478,
          36479,
          39669,
          39674,
          41222,
          41223,
          43068,
          43185
      ],
      "passives": [
          536,
          2910,
          962,
          7566,
          963,
          7567
      ]
  },
  {
      "id": 8,
      "name": "Shadowplay",
      "skills": [
          18125,
          10481,
          13344,
          12049,
          10648,
          12139,
          12029,
          10082,
          10189,
          10496,
          10104,
          23594
      ],
      "ancestrals": [
          36588,
          36589,
          36590,
          36591,
          36593,
          36594,
          39297,
          39298,
          40787,
          40788,
          44288,
          44289
      ],
      "passives": [
          7572,
          7570,
          483,
          1548,
          863,
          488
      ]
  },
  {
      "id": 9,
      "name": "Songcraft",
      "skills": [
          11973,
          11934,
          10723,
          11943,
          37839,
          10724,
          17413,
          11377,
          11396,
          37886,
          10727,
          23596
      ],
      "ancestrals": [
          36597,
          36598,
          36595,
          36596,
          36628,
          36629,
          39299,
          39300,
          40789,
          40790,
          44349,
          44379,
          43196,
          43197,
          44382,
          44383
      ],
      "passives": [
          23068,
          3840,
          494,
          7574,
          1173,
          1156
      ]
  },
  {
      "id": 10,
      "name": "Vitalism",
      "skills": [
          33345,
          11379,
          10534,
          10547,
          13286,
          10720,
          10546,
          14929,
          17412,
          16004,
          16783,
          11948
      ],
      "ancestrals": [
          36630,
          36631,
          36636,
          36637,
          36632,
          36635,
          39675,
          39676,
          41224,
          41225,
          43207,
          43208,
          43209
      ],
      "passives": [
          753,
          558,
          7586,
          7585,
          3172,
          2927
      ]
  },
  {
      "id": 11,
      "name": "Malediction",
      "skills": [
          39007,
          39012,
          39017,
          39016,
          39018,
          39015,
          39021,
          39020,
          39019,
          39022,
          39023,
          39024
      ],
      "ancestrals": [
          39163,
          39166,
          39677,
          39678,
          40791,
          40792,
          41226,
          41227
      ],
      "passives": [
          23078,
          23071,
          23079,
          23074,
          23081,
          23073
      ]
  },
  {
      "id": 12,
      "name": "Swiftblade",
      "skills": [
          40331,
          40337,
          40339,
          40333,
          40336,
          40335,
          40342,
          40334,
          40341,
          40332,
          40340,
          40338
      ],
      "ancestrals": [
          43211,
          43213,
          43212
      ],
      "passives": [
          24895,
          24913,
          24909,
          24914,
          24911,
          24910
      ]
  },
  {
      "id": 13,
      "name": "Gunslinger",
      "skills": [
          44196,
          44197,
          44200,
          44204,
          44207,
          44198,
          44206,
          44199,
          44203,
          44205,
          44201,
          44202
      ],
      "ancestrals": [
          47594,
          47596,
          47681,
          47651,
          47602,
          47645
      ],
      "passives": [
          26494,
          26495,
          26496,
          26499,
          26498,
          26497
      ]
  }
]

const db = require('better-sqlite3')('74-english.sqlite');

const createSkillset = (id, name) => {
  const skills = db.prepare('SELECT * FROM skills WHERE ability_id = ? AND show ORDER BY ability_level').all(id).map(x => x.id)
  const ancestrals = db.prepare('SELECT heir_skill_details.skill_id FROM heir_skills INNER JOIN heir_skill_details ON heir_skills.id = heir_skill_details.heir_skill_id WHERE heir_skills.skill_id IN (' + '?,'.repeat(skills.length - 1) + '?) ORDER BY step, heir_skill_details.skill_id').all(skills).map(x => x.skill_id)
  const passives = db.prepare('SELECT * FROM passive_buffs WHERE ability_id = ? ORDER BY req_points').all(id).map(x => x.buff_id)

  return {
    "id": id,
    "name": name,
    "skills": skills,
    "ancestrals": ancestrals,
    "passives": passives
  }
}

const skillsets = [
  createSkillset(1, 'Battlerage'),
  createSkillset(2, 'Witchcraft'),
  createSkillset(3, 'Defense'),
  createSkillset(4, 'Auramancy'),
  createSkillset(5, 'Occultism'),
  createSkillset(6, 'Archery'),
  createSkillset(7, 'Sorcery'),
  createSkillset(8, 'Shadowplay'),
  createSkillset(9, 'Songcraft'),
  createSkillset(10, 'Vitalism'),
  createSkillset(11, 'Malediction'),
  createSkillset(12, 'Swiftblade'),
  createSkillset(13, 'Gunslinger'),
  createSkillset(14, 'Spelldance')
]

module.exports = (req, res) => {
  res.send(skillsets)
}
